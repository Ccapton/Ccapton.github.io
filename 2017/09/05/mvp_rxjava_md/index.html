<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="爱技术爱生活">
    

    <!--Author-->
    
        <meta name="author" content="Ccapton">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="MD风格Mvp—RxJava2应用，MVP初体验"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="爱技术爱生活" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="Ccapton技术空间"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>MD风格Mvp—RxJava2应用，MVP初体验 - Ccapton技术空间</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">

    <!-- Google Analytics -->
    


<link rel="stylesheet" href="/css/prism.css" type="text/css"></head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    主页
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    归档
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/tags">
                    标签
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/categories">
                    目录
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa /favicon.ico" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/09/05/mvp_rxjava_md/">
                MD风格Mvp—RxJava2应用，MVP初体验
            </a>
        </h1>
        <div class="post-info">
            
                <span class="date">2017-09-05</span>
            
            
            
                <span class="category">
                    <a href="/categories/Android开发/">Android开发</a>
                </span>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <blockquote>
<p>关于我，欢迎关注<br>csdn博客：ccapton(<a href="http://blog.csdn.net/ccapton" target="_blank" rel="external">http://blog.csdn.net/ccapton</a>) 微信：<a href="">Ccapton</a><br>Github: (<a href="https://www.github.com/ccapton" target="_blank" rel="external">https://www.github.com/ccapton</a>)<br>个人博客:<a href="http://www.ccapton.cn/" target="_blank" rel="external">http://www.ccapton.cn</a></p>
</blockquote>
<p>项目地址<br><a href="https://github.com/Ccapton/Mvp-RxJava2" target="_blank" rel="external">https://github.com/Ccapton/Mvp-RxJava2</a><br>Demo apk:<br><a href="http://git.oschina.net/ccapton/Files/raw/master/ccapton_mvp.apk" target="_blank" rel="external">http://git.oschina.net/ccapton/Files/raw/master/ccapton_mvp.apk</a><br><a id="more"></a><br><img src="https://raw.githubusercontent.com/Ccapton/Mvp-RxJava2/master/mvp.gif" alt="主界面，数据来自我的博客RSS"></p>
<p><img src="https://raw.githubusercontent.com/Ccapton/Mvp-RxJava2/master/mvp2.gif" alt="音乐模块，来自波尼音乐"><br><img src="https://raw.githubusercontent.com/Ccapton/Mvp-RxJava2/master/mvp3.gif" alt="新闻模块，来自极速数据"></p>
<p>波尼音乐Githubdi地址<br><a href="https://github.com/wangchenyan/PonyMusic" target="_blank" rel="external">https://github.com/wangchenyan/PonyMusic</a> </p>
<p>之前，我写android代码涉及到数据与视图关系时，都是直接将数据加载到视图中，例如在<strong>RecyclerView.Adapter</strong>中的<strong>onBindViewHolder</strong>方法中<br>例如:</p>
<pre><code> @Override 
        public void onBindViewHolder(ViewHolder holder, int position) {
         TextView titleTv=((TextView)holder.itemView.findViewById(R.id.titleTv));
          titleTv.setText(articleList.get(position));
        }
</code></pre><p><strong>articleList</strong> 为通过网络获取解析后得到的Article集合。通过上面的代码可以看到，<strong>articleList</strong>是个全局变量，要么在<strong>RecyclerView.Adapter</strong>子类中，要么在Activity、Fragment中。这样的话如果要修改articleList中的数据，势必在<strong>Activity</strong>、<strong>Fragment</strong>或是<strong>RecyclerView.Adapter</strong>子类中操作，一两个数据集合不见得多几行代码，要是有4-5个或者更多呢？这样这些“容器”肯定会臃肿的非常厉害。这时就要对数据、视图与逻辑控制进行业务分离，即数据层、视图层与控制层要明确各种的工作，要做到分工明确又合作通畅。于是MVC与MVP模式便是我们整理代码逻辑的重要方式。关于MVC这里就不多说了，我直接来谈它的进化版MVP。</p>
<p>我通过阅读一篇文章 <a href="http://www.jianshu.com/p/9a6845b26856/" target="_blank" rel="external">http://www.jianshu.com/p/9a6845b26856/</a> 对MVP模式有了一些理解。下面这段总结是精华</p>
<p><strong>在MVP模式里通常包含4个要素：<br>(1) View :负责绘制UI元素、与用户进行交互(在Android中体现为Activity);<br>(2) View interface :需要View实现的接口，View通过View interface与Presenter进行交互，降低耦合，方便进行单元测试;<br>(3) Model :负责存储、检索、操纵数据(有时也实现一个Model interface用来降低耦合);<br>(4) Presenter :作为View与Model交互的中间纽带，处理与用户交互的负责逻辑。</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/7287689-fc4e72373de3688f.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Microsoft对MVC和MVP的理解"><br> 用我的话总结起来，MVP最重要的点：是实现数据（Model）与视图（View）的分离。<br>在构建好MVP代码后，通常情况我们<br><strong>1、先需要在Activity（Fragment）中实现View接口（此View非彼View），将其泛型设置为对应的Presenter，实现其抽象方法；</strong>例如：</p>
<pre><code>、、、
public class MainActivity extends BaseActivity 
      implements IView&lt;ArticlePresenter&gt;,View.OnClickListener
、、、
</code></pre><p><strong>2、然后新建Presenter子类对象（View作为参数），通过Presenter内定义的方法将Bean数据（例如：Article对象）加载到数据层（Model）中，并将数据加载到视图层（View）中；</strong>例如在RecyclerView.Adapter中的<strong>onBindViewHolder</strong>方法中</p>
<pre><code>  @Override
        public void onBindViewHolder(ViewHolder holder, int position) {
            ArticlePresenter presenter=new ArticlePresenter(MainActivity.this);
            presenter.saveData(articles.get(position));
            presenter.setDataOnView(holder.itemView);
        }
</code></pre><p><strong>3、然后在第一步实现的抽象方法中，通过Presenter进行具体的视图（View）加载数据（Model）操作；</strong>例如：</p>
<pre><code>@Override
    public void setDataOnView(final ArticlePresenter presenter, View view) {
        TextView view1= (TextView) view.findViewById(R.id.title);
        TextView view2= (TextView) view.findViewById(R.id.author);
        TextView view3= (TextView) view.findViewById(R.id.date);
        view1.setText(((Article)presenter.getData()).getTitle());
        view2.setText(((Article)presenter.getData()).getAuthor());
        view3.setText(((Article)presenter.getData()).getDate());
        RelativeLayout article_item = (RelativeLayout) view.findViewById(R.id.article_item);
        article_item.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                startActivity(WebActivity.class,((Article)presenter.getData()).getId());
            }
        });
    }
</code></pre><p>以上是我的MVP调用代码，看似比之前直接将数据设置到视图中代码量多是吧。但将数据操作的大量代码封装进了Model层中，Presenter就可以直接调用达到修改数据的目的，就可以在Activity中省下一大段代码了。</p>
<p>说了那么多，还有朋友不知道怎么写MVP代码，这是一个既简单又有点恶心的步骤，下面是我为这个应用写的MVP代码，虽然没有封装其他数据操作的方法，但是对于理解MVP来说够用了吧。<br><strong>首先是两个接口（IView、IModel）和一个抽象类IPresenter<br>IView.java</strong></p>
<pre><code>public interface IView&lt;IPresenter&gt;{
    /**
     * 等待Present调用的方法，子类（例如Activity，Fragment）实现其具体代码
     * @param iPresenter 返回的iPresenter本体对象
     * @param view   你要加载的具体视图；例如在RecyclerView中，
     *                                onBindViewHolder方法里的viewHolder.itemView;
     */
    void setDataOnView(IPresenter iPresenter,View view);
}
</code></pre><p><strong>IModel.java</strong></p>
<pre><code>public interface IModel{
    /**
     *   设置Bean数据
     * @param object
     */
    void set(Object object);

    /**
     *   获取Bean数据
     * @return
     */
    Object get();
}
</code></pre><p><strong>IPresenter.java</strong></p>
<pre><code>public abstract class IPresenter{
    IView&lt;IPresenter&gt; iView;  //Activity，Fragment实现此接口，等待IPresenter子类对象 回调 setDataOnView()方法
    IModel iModel;            //数据模型，不暴露给Activity，Fragment等IView子类
    /**
     * 以IView子类作为参数的构造函数
     * @param iView 例如，Activity.this
     */
    public IPresenter(IView&lt;IPresenter&gt; iView){
        this.iView=iView;
    }

    /**
     * 传入view，IPresenter子类将从Model层中获取Bean数据，再加载到view中（用于ListView,RecycerView等列表视图）
     * @param view
     */
    public abstract void setDataOnView(View view);

    /**
     * 设置Bean数据到Model层的IModel子类中去
     * @param object Bean数据对象，例如Article对象
     */
    public abstract void saveData(Object object);

    /**
     * 从Model层获取Bean数据
     * @return 
     */
    public abstract Object getData();        
}
</code></pre><p>接下来是上面三个父类的具体实现子类 <strong>Activity、ArticleModel、 ArticlePresenter</strong><br>Acitivity只需要实现IView接口即可，并实现其抽象方法。上面已经给出了代码</p>
<p><strong>ArticleModel.java</strong></p>
<pre><code>public class ArticleModel implements IModel {

    private Article mArticle=new Article();

    @Override
    public void set(Object object) {
        mArticle= (Article) object;
    }

    @Override
    public  Object  get() {
        return mArticle;
    }

}
</code></pre><p><strong>ArticlePresenter.java</strong></p>
<pre><code>public class ArticlePresenter extends IPresenter{

    public ArticlePresenter(IView iView){
        super(iView);
        this.iModel=new ArticleModel();
    }

    @Override
    public void setDataOnView(View view) {
        iView.setDataOnView(ArticlePresenter.this,view);
    }

    @Override
    public void saveData(Object object) {
        iModel.set(object);
    }

    @Override
    public Object getData() {
        return this.iModel.get();
    }
}
</code></pre><p>通过上面代码可以看出，ArticlePresenter实现了父类的saveData(Object object)，setData(Objec object)和getData()方法。</p>
<ul>
<li><strong>getData()</strong>：从IModel子类(ArticleModel)对象中返回具体的数据</li>
<li><strong>saveData(Object object)</strong>：通过IModel子类(ArticleModel)对象iModel的set(object)方法将数据存入Model中，等待调用。</li>
<li><strong>setData(Objec object)</strong>：通过Activity(IView子类)对象iView的setDataOnView(ArticlePresenter.this,view)操作,将数据加载到视图中。</li>
</ul>
<p>至此，我对于MVP模式的理解到此为止，欢迎朋友们与我交流探讨！</p>
<p>下面是这个Demo用到的各种库与框架：</p>
<pre><code>    compile &#39;com.android.support:design:25.3.1&#39;
    compile &#39;com.lapism:searchview:5.0.0-alpha4&#39;
    compile &#39;com.scwang.smartrefresh:SmartRefreshLayout:1.0.3&#39;
    compile &#39;com.scwang.smartrefresh:SmartRefreshHeader:1.0.3&#39;
    compile &#39;de.hdodenhof:circleimageview:2.1.0&#39;
    compile &#39;me.xiaopan:sketch:2.4.1&#39;
    compile &#39;online.osslab:CircleProgress:1.0.0&#39;
    compile &#39;com.github.Ccapton:Android-ColorfulProgressBar:1.0.5&#39;
    compile &#39;cn.hugeterry.coordinatortablayout:coordinatortablayout:1.1.0&#39;
    compile &#39;com.jakewharton:butterknife:8.8.1&#39;
    annotationProcessor &#39;com.jakewharton:butterknife-compiler:8.8.1&#39;
    compile &#39;io.reactivex.rxjava2:rxandroid:2.0.1&#39;
    compile &#39;io.reactivex.rxjava2:rxjava:2.1.3&#39;
    compile &#39;com.squareup.okhttp3:okhttp:3.8.1&#39;
    compile &#39;com.github.bumptech.glide:glide:3.8.0&#39;
    annotationProcessor &#39;com.github.bumptech.glide:compiler:4.0.0&#39;
    compile &#39;com.just.agentweb:agentweb:2.0.0&#39;
    compile &#39;com.blankj:utilcode:1.8.5&#39;
</code></pre><p>欢迎大家来踩我的Github <a href="https://github.com/ccapton" target="_blank" rel="external">https://github.com/ccapton</a> 、博客 <a href="http://ccapton.cn">http://ccapton.cn</a></p>
<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=413834646&auto=0&height=66"></iframe>


    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/Android开发/">#Android开发</a> <a href="/tags/Android/">#Android</a> <a href="/tags/个人作品/">#个人作品</a>
        </div>
    

    <!-- Comments -->
    

</div>
        </section>

    </div>
</div>


</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>关于</h2>
                <p>
                    主题源自<a href="https://github.com/klugjo">Jonathan Klughertz</a>. 源码在Github可用.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>最近发布</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2018/08/09/science2/">科学上网最优方案 ( VPS + Lotsever</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/08/04/lifan/">利用python抓包、爬取裡蕃收藏夹（移动app）</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/07/30/filetransporter/">用python打造一个基于socket的文件（夹）</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2018/06/20/rolecontroller/">基于cocos2d-x引擎的角色控制器</a>
            </li>
            
        </ul>
    </div>



            
<div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 footer-categories">
    <h2>归档</h2>
    <ul>
        
        <li>
            <a class="footer-post" href="/categories/游戏开发/">游戏开发</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Android/">Android</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Java技术/">Java技术</a>
        </li>
        
        <li>
            <a class="footer-post" href="/categories/Python/">Python</a>
        </li>
        
    </ul>
</div>

        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://github.com/ccapton">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:chenweibin1125@foxmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="\atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    @Ccapton. All right reserved | Design & Hexo <a href="http://www.codeblocq.com/">Jonathan Klughertz</a>
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->



</body>

</html>